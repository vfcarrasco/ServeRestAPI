name: Run ServeRest API Tests

on:
  workflow_dispatch: # Permite execução manual no GitHub

jobs:
  run-api-tests:
    runs-on: ubuntu-latest # Sobe uma máquina Ubuntu na versão mais recente

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3 # Faz o checkout do código do repositório

      - name: Create test directory and copy files
        run: |
          mkdir -p ~/serrest-tests # Cria diretório para os testes
          cp ServeRest_API.postman_collection.json ~/serrest-tests/
          cp ServeRest.postman_environment.json ~/serrest-tests/
          cd ~/serrest-tests

      - name: Install Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20' # Instala Node.js versão 20 (ou a versão mais recente estável)

      - name: Install Newman and HTML Extra Reporter
        run: |
          npm install -g newman # Instala Newman globalmente
          npm install -g newman-reporter-htmlextra # Instala o reporter HTML Extra

      - name: Run API tests with Newman
        run: |
          cd ~/serrest-tests
          newman run ServeRest_API.postman_collection.json \
            -e ServeRest.postman_environment.json \
            -r cli,htmlextra \
            --reporter-htmlextra-export test-report.html # Roda os testes com relatório em HTML

      - name: Upload HTML report
        uses: actions/upload-artifact@v3
        with:
          name: serve-rest-html-report
          path: ~/serrest-tests/test-report.html # Anexa o relatório como artefato no GitHub

      # A máquina encerra após o fim do job
