trigger:
  - main  # Ou a branch desejada

pool:
  vmImage: 'ubuntu-latest'

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '18.x'
    displayName: 'Instalar Node.js'

  - script: |
      npm install -g newman
      npm install -g newman-reporter-html
    displayName: 'Instalar Newman e Reporter HTML'

  - checkout: self

  - script: |
      newman run ./tests/postman/ServeRest.postman_collection.json \
        -e ./tests/postman/ServeRest.postman_environment.json \
        -r cli,html \
        --reporter-html-export ./newman/report.html
    displayName: 'Executar testes Postman com Newman'

  - task: PublishBuildArtifacts@1
    inputs:
      PathtoPublish: 'newman'
      ArtifactName: 'RelatorioNewman'
      publishLocation: 'Container'
    displayName: 'Publicar Relat√≥rio HTML'
